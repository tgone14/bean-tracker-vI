<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bean - Dialysis Tracker</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f8fafc; -webkit-tap-highlight-color: transparent; }
        .bean-gradient { background: linear-gradient(135deg, #7c9aff 0%, #a881e6 100%); }
        .progress-bar-bg { background-color: #f1f5f9; border-radius: 9999px; height: 0.6rem; overflow: hidden; }
        .progress-fill { height: 100%; transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        .card { background: white; border-radius: 24px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); border: 1px solid #f1f5f9; }
        .label-text { font-size: 0.75rem; font-weight: 600; color: #64748b; text-transform: uppercase; letter-spacing: 0.025em; }
        .value-text { font-size: 0.75rem; font-weight: 700; color: #1e293b; }
        
        .p-green { background-color: #f0fdf4; border-left: 4px solid #22c55e; }
        .p-yellow { background-color: #fefce8; border-left: 4px solid #eab308; }
        .p-red { background-color: #fef2f2; border-left: 4px solid #ef4444; }
        .p-neutral { background-color: #f8fafc; border-left: 4px solid #cbd5e1; }

        .dot-green { background-color: #22c55e; }
        .dot-yellow { background-color: #eab308; }
        .dot-red { background-color: #ef4444; }
        .dot-protein { background-color: #38bdf8; }
    </style>
</head>
<body class="pb-24">

    <header class="bean-gradient text-white pt-12 pb-10 px-6 shadow-md rounded-b-[40px] mb-6 text-center">
        <h1 class="text-5xl font-extrabold tracking-tight">Bean</h1>
        <p class="text-sm font-medium opacity-80 mt-2" id="current-date"></p>
    </header>

    <main class="max-w-md mx-auto p-4 space-y-6">

        <section class="card p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-sm font-bold text-slate-800 uppercase tracking-wider">Net Daily Intake</h2>
                <button onclick="exportData()" class="text-[10px] bg-slate-100 text-slate-600 px-3 py-1 rounded-full font-bold uppercase">Export</button>
            </div>
            
            <div class="space-y-6">
                <div>
                    <div class="flex justify-between mb-2">
                        <span class="label-text">Potassium</span>
                        <span class="value-text"><span id="total-k">0</span> / <span id="disp-limit-k">2000</span> mg</span>
                    </div>
                    <div class="progress-bar-bg"><div id="bar-k" class="progress-fill" style="width: 0%; background-color: #34d399;"></div></div>
                </div>
                <div>
                    <div class="flex justify-between mb-2">
                        <span class="label-text">Net Phosphorus</span>
                        <span class="value-text"><span id="total-p">0</span> / <span id="disp-limit-p">1000</span> mg</span>
                    </div>
                    <div class="progress-bar-bg"><div id="bar-p" class="progress-fill" style="width: 0%; background-color: #a78bfa;"></div></div>
                </div>
                <div>
                    <div class="flex justify-between mb-2">
                        <span class="label-text">Fluid</span>
                        <span class="value-text"><span id="total-f">0</span> / <span id="disp-limit-f">1000</span> ml</span>
                    </div>
                    <div class="progress-bar-bg"><div id="bar-f" class="progress-fill" style="width: 0%; background-color: #38bdf8;"></div></div>
                </div>
                <div>
                    <div class="flex justify-between mb-2">
                        <span class="label-text">Protein</span>
                        <span class="value-text"><span id="total-pr">0</span> / <span id="disp-limit-pr">60</span> g</span>
                    </div>
                    <div class="progress-bar-bg"><div id="bar-pr" class="progress-fill" style="width: 0%; background-color: #3b82f6;"></div></div>
                </div>
            </div>
        </section>

        <div class="flex space-x-1 bg-slate-200/50 p-1.5 rounded-2xl">
            <button onclick="switchTab('food')" id="tab-food" class="flex-1 py-2.5 rounded-xl font-bold text-sm bg-white shadow-sm text-slate-800 transition-all">Food</button>
            <button onclick="switchTab('binder')" id="tab-binder" class="flex-1 py-2.5 rounded-xl font-bold text-sm text-slate-500 transition-all">Binder</button>
            
        </div>

        <section id="section-food" class="card p-5 space-y-4">
            <div class="relative">
                <input type="text" id="food-search" placeholder="Search foods (Milk, Cheese, Egg)..." 
                    class="w-full p-4 bg-slate-50 border-none rounded-2xl outline-none focus:ring-2 focus:ring-purple-200" 
                    onkeyup="searchFood(this.value)">
                <div id="search-results" class="hidden absolute z-30 w-full bg-white border rounded-2xl shadow-2xl mt-2 max-h-72 overflow-y-auto"></div>
            </div>
            
            <div class="text-center text-[10px] font-bold text-slate-400 uppercase tracking-widest">— OR —</div>
            
            <select id="category-select" class="w-full p-4 bg-slate-50 border-none rounded-2xl text-sm font-semibold" onchange="renderCategoryItems(this.value)">
                <option value="" disabled selected>Browse Categories</option>
            </select>
            <button onclick="addCustomFood()" class="w-full mt-2 p-4 bg-purple-50 text-purple-700 border border-purple-100 rounded-2xl text-sm font-bold uppercase tracking-wide">+ Add Custom Entry</button>
            <div id="category-items-list" class="space-y-2 mt-2 max-h-60 overflow-y-auto hidden"></div>
        </section>

        <section id="section-binder" class="hidden card p-6 text-center">
            <select id="binder-select" class="w-full p-4 bg-slate-50 border-none rounded-2xl text-sm mb-4" onchange="checkBinderEnable()">
                <option value="" disabled selected>Select Binder Type</option>
                <option value="0">Renvela/Sevelamer (800mg)</option>
                <option value="1">Phoslo/Calcium Acetate (667mg)</option>
                <option value="2">Tums/Calcium Carbonate (500mg)</option>
                <option value="3">Velphoro (500mg)</option>
                <option value="4">Auryxia (210mg Iron)</option>
                <option value="5">Fosrenol/Lanthanum (500mg)</option>
            </select>
            <div class="flex items-center justify-center space-x-8 py-4">
                <button onclick="changeQty(-1)" class="w-14 h-14 rounded-2xl bg-slate-100 text-2xl font-bold">-</button>
                <span id="binder-qty-display" class="text-4xl font-black w-10">1</span>
                <button onclick="changeQty(1)" class="w-14 h-14 rounded-2xl bg-slate-100 text-2xl font-bold">+</button>
            </div>
            <button onclick="addBinder()" id="add-binder-btn" class="w-full bg-slate-800 text-white font-bold py-5 rounded-2xl disabled:opacity-20" disabled>Add Binder</button>
        </section>


        <section id="section-log">
            <div class="flex justify-between items-end mb-4 px-2">
                <h2 class="text-xl font-bold text-slate-800">Today's Entries</h2>
                <button onclick="clearToday()" class="text-[10px] text-red-400 font-black uppercase">Reset</button>
            </div>
            <ul id="log-list" class="space-y-3"></ul>
        </section>

        <section class="bg-slate-100 p-6 rounded-[32px] border border-slate-200 text-center">
            <h3 class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-4">Set Your Limits</h3>
            <div class="grid grid-cols-2 gap-4">
                <div><label class="label-text block mb-1">K (mg)</label><input type="number" id="limit-k" class="w-full p-3 bg-white rounded-xl text-center font-bold" onchange="saveSettings()"></div>
                <div><label class="label-text block mb-1">P (mg)</label><input type="number" id="limit-p" class="w-full p-3 bg-white rounded-xl text-center font-bold" onchange="saveSettings()"></div>
                <div><label class="label-text block mb-1">Fluid (ml)</label><input type="number" id="limit-f" class="w-full p-3 bg-white rounded-xl text-center font-bold" onchange="saveSettings()"></div>
                <div><label class="label-text block mb-1">PRO (g)</label><input type="number" id="limit-pr" class="w-full p-3 bg-white rounded-xl text-center font-bold" onchange="saveSettings()"></div>
            </div>
        </section>
    </main>

    <script>
        const foodDatabase = {
            "Fruits": [
                { name: "Apple (1 med)", k: 133, p: 12, f: 0, pr: 0.25 },
                { name: "Blueberries (1 cup)", k: 114, p: 18, f: 0, pr: 1.1 },
                { name: "Strawberries (1 cup)", k: 220, p: 35, f: 0, pr: 1 },
                { name: "Raspberries (1 cup)", k: 186 , p: 15, f: 0, pr: 1.5 },
                { name: "Blackberries (1/2 cup)", k: 233, p: 32, f: 0, pr: 2 },
                { name: "Grapes (10 small)", k: 115, p: 12, f: 0, pr: 0.5 },
                { name: "Pineapple (1/2 cup)", k: 90, p: 7, f: 0, pr: 0.45 },
                { name: "Watermelon (1 cup)", k: 170, p: 15, f: 140, pr: 1 },
                { name: "Peach (1 med)", k: 179, p: 32, f: 0, pr: 1.3 },
                { name: "Peaches, Canned (1/2 cup)", k: 121, p: 12, f: 0, pr: 0.5 },
                { name: "Plum (1 med)", k: 104, p: 11, f: 0, pr: 0.4 },
                { name: "Pear (1 med)", k: 206, p: 21, f: 0, pr: 0.6 },
                { name: "Cherries (10)", k: 184, p: 18, f: 0, pr: 0.8 },
                { name: "Cranberries (1/2 cup)", k: 40, p: 6, f: 0, pr: 0.2 },
                { name: "Mandarin Orange (1 small)", k: 126, p: 15, f: 0, pr: 0.6 }
            ],
            "Dairy": [
                { name: "Milk, Whole (1 cup)", k: 374, p: 251, f: 240, pr: 8.1 },
                { name: "Milk, Reduced Fat 2% (1 cup)", k: 390, p: 252, f: 240, pr: 8.2 },
                { name: "Milk, Lowfat 1% (1 cup)", k: 391, p: 253, f: 240, pr: 8.3 },
                { name: "Milk, Skim Nonfat (1 cup)", k: 411, p: 263, f: 240, pr: 8.4 },
                { name: "Rice Milk (1 cup)", k: 65, p: 48, f: 240, pr: 0.6 },
                { name: "Soy Milk (1 cup)", k: 371, p: 161, f: 240, pr: 8.3 },
                { name: "Almond Milk, Vanilla (1 cup)", k: 120, p: 19, f: 240, pr: 1 },
                { name: "Almond Milk, Unsweetened (1 cup)", k: 49, p: 19, f: 240, pr: 0.7 },
                { name: "Yogurt (6 oz)", k: 398, p: 245, f: 170, pr: 9 },
                { name: "Cheddar Cheese (1 oz)", k: 21, p: 129, f: 0, pr: 7 },
                { name: "Cream Cheese, Lowfat (1 tbsp)", k: 50, p: 94, f: 0, pr: 2.8 },
                { name: "Swiss Cheese (1 oz)", k: 20, p: 163, f: 0, pr: 7.5 },
                { name: "Cottage Cheese, Lowfat 2% (1/2 cup)", k: 86, p: 150, f: 0, pr: 12 }
            ],
            "Vegetables": [
                { name: "Asparagus (1/2 cup)", k: 135, p: 35, f: 0, pr: 1.5 },
                { name: "Beets, Canned (1/2 cup)", k: 126, p: 14, f: 0, pr: 0.75 },
                { name: "Broccoli (1/2 cup)", k: 115, p: 25, f: 0, pr: 1 },
                { name: "Butternut Squash (1/2 cup)", k: 215, p: 23, f: 0, pr: 0.7 },
                { name: "Carrots (1/2 cup)", k: 180, p: 24, f: 0, pr: 0.6 },
                { name: "Green Beans (1/2 cup)", k: 115, p: 19, f: 0, pr: 1 },
                { name: "Cucumber (1/2 cup)", k: 76, p: 12, f: 25, pr: 0.3 },
                { name: "Onions (1/2 cup)", k: 125, p: 30, f: 0, pr: 0.6 },
                { name: "Cabbage (1/2 cup)", k: 75, p: 11, f: 0, pr: 0.6 },
                { name: "Cauliflower (1/2 cup)", k: 160, p: 23, f: 0, pr: 1 },
                { name: "Eggplant (1/2 cup)", k: 94, p: 10, f: 0, pr: 0.4 },
                { name: "Lettuce (1 cup)", k: 70, p: 10, f: 0, pr: 0.5 },
                { name: "Mushrooms (1/2 cup)", k: 111, p: 30, f: 0, pr: 1 },
                { name: "Peppers, Green (1/2 cup)", k: 80, p: 9, f: 0, pr: 0.4 },
                { name: "Potato, Baked", k: 941, p: 130, f: 0, pr: 1.25 },
                { name: "Plantain, Boiled (1 cup)", k: 396, p: 32, f: 0, pr: 1.5 },
                { name: "Spinach, Raw (1 cup)", k: 167, p: 14, f: 0, pr: 0.9 },
                { name: "Sweet Potato, Baked", k: 542, p: 61, f: 0, pr: 2.3 },
                { name: "Tomato Sauce, Canned (1/2 cup)", k: 364, p: 33, f: 0, pr: 1.5 },
                { name: "Yautia (1/2 cup)", k: 403, p: 34, f: 0, pr: 1 },
                { name: "Zucchini (1/2 cup)", k: 162, p: 24, f: 0, pr: 0.7 }
            ],
            "Grains": [
                
                { name: "Bagel (1 med)", k: 96, p: 90, f: 0, pr: 10 },
                { name: "Corn Tortilla (1 med)", k: 46, p: 63, f: 0, pr: 1.4 },
                { name: "Cream of Wheat (1 cup cooked)", k: 27, p: 20, f: 0, pr: 3.6 },
                { name: "English Muffin", k: 74, p: 72, f: 0, pr: 4 },
                { name: "Grits, White (1 cup cooked)", k: 45, p: 35, f: 0, pr: 4 },
                { name: "Italian Bread (1 slice)", k: 30, p: 28, f: 0, pr: 2.5 },
                { name: "Pancake", k: 102, p: 122, f: 0, pr: 5 },
                { name: "Pasta, White (1 cup cooked)", k: 61, p: 76, f: 0, pr: 8.1 },
                { name: "Pita Bread (1 large)", k: 60, p: 58, f: 0, pr: 5.5 },
                { name: "Popcorn, Unsalted (3 cups)", k: 56, p: 86, f: 0, pr: 3 },
                { name: "Rye Bread (1 slice)", k: 53, p: 40, f: 0, pr: 2.7 },
                { name: "Saltine Crackers (5 crackers)", k: 24, p: 18, f: 0, pr: 1 },
                { name: "Wheat Tortilla (1 med)", k: 90, p: 85, f: 0, pr: 4 },
                { name: "White Bread (1 slice)", k: 32, p: 31, f: 0, pr: 2.5 },
                { name: "White Rice (1/2 cup)", k: 27, p: 34, f: 0, pr: 2.2 },
                { name: "Whole Wheat Bread (1 slice)", k: 80, p: 68, f: 0, pr: 4 },
                { name: "Whole Wheat Pasta (1 cup cooked)", k: 147, p: 172, f: 0, pr: 7.5 }
                
            ],
            "Proteins": [
                
                { name: "Almond Butter (2 tbsp)", k: 240, p: 160, f: 0, pr: 7 },
                { name: "Bacon (1 slice)", k: 44, p: 41, f: 0, pr: 9 },
                { name: "Chicken (3 oz)", k: 283, p: 174, f: 0, pr: 18 },
                { name: "Egg (1)", k: 66, p: 92, f: 0, pr: 6.25 },
                { name: "Ground Beef (3 oz)", k: 300, p: 181, f: 0, pr: 21 },
                { name: "Hot Dog, Beef", k: 186, p: 70, f: 0, pr: 7 },
                { name: "Mussels", k: 228, p: 242, f: 0, pr: 20 }, 
                { name: "Salmon (3 oz)", k: 373, p: 266, f: 0, pr: 21 },
                { name: "Sardines, Canned (3 oz)", k: 338, p: 417, f: 0, pr: 21 },
                { name: "Tuna Salad (1/2 cup)", k: 180, p: 145, f: 0, pr: 16 },
                { name: "Turkey Bacon (1 slice)", k: 23, p: 21, f: 0, pr: 2 },
                { name: "Peanut Butter (2 tbsp)", k: 189, p: 101, f: 0, pr: 8 },
                { name: "Pork (3 oz)", k: 308, p: 192, f: 0, pr: 21 },
                { name: "Chicken Nuggets, Wendys (5 Pieces)", k: 170, p: 184, f: 0, pr: 11 }
            ],
            "Beverages": [
                { name: "Water (8 oz)", k: 0, p: 0, f: 240, pr: 0 },
                { name: "Coffee (8 oz)", k: 116, p: 7, f: 240, pr: 0 },
                { name: "Tea (8 oz)", k: 88, p: 0, f: 240, pr: 0 },
                { name: "Lemonade (8 oz)", k: 40, p: 5, f: 240, pr: 0 }
            ]
        };

        const binderDatabase = [
            { name: "Renvela/Sevelamer", bind: 17 }, { name: "Phoslo/Calcium Acetate", bind: 30 },
            { name: "Tums/Calcium Carbonate", bind: 19 }, { name: "Velphoro", bind: 130 },
            { name: "Auryxia", bind: 40 }, { name: "Fosrenol", bind: 45 }
        ];

        let dailyLog = JSON.parse(localStorage.getItem('bean_log')) || [];
        let limits = JSON.parse(localStorage.getItem('bean_limits')) || { k: 2000, p: 1000, f: 1000, pr: 60 };
        let binderQty = 1;

        function getRiskLevel(food) {
    // 0 = Green, 1 = Yellow, 2 = Red
    let kScore = 0;
    if (food.k > 200) kScore = 2;      // High Potassium
    else if (food.k > 100) kScore = 1; // Med Potassium

    let pScore = 0;
    if (food.p > 150) pScore = 2;      // High Phosphorus
    else if (food.p > 50) pScore = 1;  // Med Phosphorus

    // Determine the highest risk level (The dot color)
    const maxScore = Math.max(kScore, pScore);
    
    // Determine the label (Med or High) based on the highest score
    const levelText = maxScore === 2 ? "High" : "Med";
    
    // Determine the reason (K, P, or K+P)
    let reason = "";
    if (maxScore > 0) {
        // If Potassium matches the highest risk level, add K
        if (kScore === maxScore) reason += "K";
        // If Phosphorus matches the highest risk level, add P
        if (pScore === maxScore) reason += (reason ? "+P" : "P");
        
        reason = `<span class="ml-2 px-1.5 py-0.5 bg-black/10 rounded text-[9px] font-bold">${levelText} ${reason}</span>`;
    }

    const colors = ["p-green", "p-yellow", "p-red"];
    const dots = ["dot-green", "dot-yellow", "dot-red"];
    
    return {
        cardClass: colors[maxScore],
        dotClass: dots[maxScore],
        label: reason
    };
}

        function searchFood(query) {
    const resultsDiv = document.getElementById('search-results');
    if (query.length < 1) { 
        resultsDiv.classList.add('hidden'); 
        return; 
    }
    
    let html = '';
    for (const [category, foods] of Object.entries(foodDatabase)) {
        foods.forEach(food => {
            if (food.name.toLowerCase().includes(query.toLowerCase())) {
                const risk = getRiskLevel(food); 
                html += `<div onclick='logFoodItem(${JSON.stringify(food)}, "${category}")' class="p-4 border-b hover:bg-slate-50 cursor-pointer flex justify-between items-center">
                    <div>
                        <div class="font-bold text-slate-700 text-sm">${food.name} ${risk.label}</div>
                        <div class="text-[9px] text-slate-400 uppercase font-black">${category}</div>
                    </div>
                    <div class="w-3 h-3 rounded-full ${risk.dotClass}"></div>
                </div>`;
            }
        });
    }
    resultsDiv.innerHTML = html || `<div class="p-4 text-xs text-slate-400">No matches found</div>`;
    resultsDiv.classList.remove('hidden');
}
        function renderCategoryItems(cat) {
    const list = document.getElementById('category-items-list');
    list.innerHTML = ''; 
    list.classList.remove('hidden');
    foodDatabase[cat].forEach(food => {
        const risk = getRiskLevel(food);
        const div = document.createElement('div');
        div.className = "p-4 bg-slate-50 rounded-2xl flex justify-between items-center cursor-pointer";
        div.onclick = () => logFoodItem(food, cat);
        div.innerHTML = `
            <span class="font-bold text-sm text-slate-800">${food.name} ${risk.label}</span>
            <div class="w-3 h-3 rounded-full ${risk.dotClass}"></div>`;
        list.appendChild(div);
    });
}

        function addCustomFood() {
            const name = prompt("Food name:");
            if (!name) return;
            const k = parseInt(prompt("Potassium (mg):", "0")) || 0;
            const p = parseInt(prompt("Phosphorus (mg):", "0")) || 0;
            const f = parseInt(prompt("Fluid (ml):", "0")) || 0;
            const pr = parseFloat(prompt("Protein (g):", "0")) || 0;
            dailyLog.push({ name: name + " (Custom)", k: k, p: p, f: f, pr: pr, category: "Custom", id: Date.now() });
            saveAll();
        }

        function logFoodItem(food, category) {
            const qty = prompt(`How many servings of ${food.name}?`, "1");
            const numQty = parseFloat(qty);
            if (isNaN(numQty) || numQty <= 0) return;
            dailyLog.push({ 
                ...food, 
                name: numQty === 1 ? food.name : `${numQty}x ${food.name}`,
                k: Math.round(food.k * numQty), 
                p: Math.round(food.p * numQty), 
                f: Math.round(food.f * numQty), 
                pr: parseFloat((food.pr * numQty).toFixed(1)),
                category: category, 
                id: Date.now() 
            });
            document.getElementById('food-search').value = '';
            document.getElementById('search-results').classList.add('hidden');
            document.getElementById('category-items-list').classList.add('hidden');
            document.getElementById('category-select').selectedIndex = 0;
            saveAll();
        }

       function renderLog() {
    const list = document.getElementById('log-list'); 
    list.innerHTML = '';
    dailyLog.slice().reverse().forEach(i => {
        const li = document.createElement('li');
        
        // This line checks if it's a binder (neutral) or food (uses risk logic)
        const risk = i.category === "Binder" ? { cardClass: "p-neutral", label: "" } : getRiskLevel(i);
        
        li.className = `p-4 rounded-3xl flex justify-between items-center ${risk.cardClass} mb-3 shadow-sm`;
        li.innerHTML = `<div>
            <div class="flex items-center">
                <span class="font-bold text-sm text-slate-800">${i.name}</span>
                ${risk.label}
            </div>
            <div class="text-[10px] opacity-60 font-bold uppercase tracking-tighter">
                K: ${i.k} | P: ${i.p} | F: ${i.f}ml | PRO: ${i.pr || 0}g
            </div>
        </div>
        <button onclick="removeItem(${i.id})" class="text-red-400 font-bold px-3 py-1 bg-red-50 rounded-full ml-4">✕</button>`;
        list.appendChild(li);
    });
}

        function updateTotals() {
            let tk=0, tp=0, tf=0, tpr=0; 
            dailyLog.forEach(i => { 
                tk += i.k; 
                tp += i.p; 
                tf += i.f; 
                tpr += (i.pr || 0); 
            });
            document.getElementById('total-k').textContent = tk;
            document.getElementById('total-p').textContent = Math.max(0, tp);
            document.getElementById('total-f').textContent = tf;
            document.getElementById('total-pr').textContent = tpr.toFixed(1);
            updateBar('bar-k', tk, limits.k);
            updateBar('bar-p', Math.max(0, tp), limits.p);
            updateBar('bar-f', tf, limits.f);
            updateBar('bar-pr', tpr, limits.pr || 60);
        }

        function updateBar(id, v, m) {
            const pct = Math.min((v/m)*100, 100);
            const b = document.getElementById(id);
            b.style.width = pct+'%';
            b.style.backgroundColor = pct >= 100 ? "#f43f5e" : (id==='bar-k'?"#34d399":id==='bar-p'?"#a78bfa":"#38bdf8");
        }

        function changeQty(amt) { binderQty = Math.max(1, binderQty + amt); document.getElementById('binder-qty-display').textContent = binderQty; }
        function checkBinderEnable() { document.getElementById('add-binder-btn').disabled = false; }
        
        function addBinder() {
            const b = binderDatabase[document.getElementById('binder-select').value];
            dailyLog.push({ name: `${binderQty}x ${b.name}`, k: 0, p: -(b.bind * binderQty), f: 0, pr: 0, category: 'Binder', id: Date.now() });
            saveAll();
        }

        function exportData() {
            if (dailyLog.length === 0) { alert("No entries to export yet!"); return; }
            const date = new Date().toLocaleDateString();
            let tk=0, tp=0, tf=0, tpr=0;
            let foodList = "";
            dailyLog.forEach(i => {
                tk += i.k; tp += i.p; tf += i.f; tpr += (i.pr || 0);
                foodList += `- ${i.name} (K: ${i.k}, P: ${i.p}, F: ${i.f}, PRO: ${i.pr})\n`;
            });
            const message = `Bean Dialysis Report - ${date}\n--------------------------\nTOTALS:\nPotassium: ${tk}mg\nPhosphorus: ${tp}mg\nFluid: ${tf}ml\nProtein: ${tpr.toFixed(1)}g\n\nENTRIES:\n${foodList}`;
            if (navigator.share) { navigator.share({ title: `Bean Report ${date}`, text: message }).catch(console.error); } 
            else { navigator.clipboard.writeText(message); alert("Report copied to clipboard!"); }
        }

        function saveAll() { localStorage.setItem('bean_log', JSON.stringify(dailyLog)); updateTotals(); renderLog(); }
        
        function saveSettings() {
            limits = { 
                k: parseInt(document.getElementById('limit-k').value) || 2000, 
                p: parseInt(document.getElementById('limit-p').value) || 1000, 
                f: parseInt(document.getElementById('limit-f').value) || 1000,
                pr: parseInt(document.getElementById('limit-pr').value) || 60 
            };
            localStorage.setItem('bean_limits', JSON.stringify(limits));
            document.getElementById('disp-limit-k').textContent = limits.k; 
            document.getElementById('disp-limit-p').textContent = limits.p; 
            document.getElementById('disp-limit-f').textContent = limits.f;
            document.getElementById('disp-limit-pr').textContent = limits.pr;
            updateTotals();
        }
        
        function removeItem(id) { dailyLog = dailyLog.filter(i => i.id !== id); saveAll(); }
        function clearToday() { if(confirm("Reset today?")) { dailyLog = []; saveAll(); } }
        
        function switchTab(t) { 
    ['food', 'binder'].forEach(tab => {
        document.getElementById(`section-${tab}`).classList.toggle('hidden', t !== tab);
        const btn = document.getElementById(`tab-${tab}`);
        if(t===tab){ btn.classList.add('bg-white','shadow-sm','text-slate-800'); btn.classList.remove('text-slate-500'); }
        else { btn.classList.remove('bg-white','shadow-sm','text-slate-800'); btn.classList.add('text-slate-500'); }
    }); 
}

        function init() {
            document.getElementById('current-date').textContent = new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' });
            document.getElementById('limit-k').value = limits.k; 
            document.getElementById('limit-p').value = limits.p; 
            document.getElementById('limit-f').value = limits.f;
            document.getElementById('limit-pr').value = limits.pr || 60;
            document.getElementById('disp-limit-k').textContent = limits.k; 
            document.getElementById('disp-limit-p').textContent = limits.p; 
            document.getElementById('disp-limit-f').textContent = limits.f;
            document.getElementById('disp-limit-pr').textContent = limits.pr || 60;
            const cs = document.getElementById('category-select'); 
            Object.keys(foodDatabase).forEach(cat => cs.add(new Option(cat, cat)));
            saveAll();
        }
        init();
    </script>
</body>
</html>





























