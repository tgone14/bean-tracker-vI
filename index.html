<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bean - Dialysis Tracker</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f8fafc; -webkit-tap-highlight-color: transparent; }
        .bean-gradient { background: linear-gradient(135deg, #7c9aff 0%, #a881e6 100%); }
        .progress-bar-bg { background-color: #f1f5f9; border-radius: 9999px; height: 0.6rem; overflow: hidden; }
        .progress-fill { height: 100%; transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        .card { background: white; border-radius: 24px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); border: 1px solid #f1f5f9; }
        .label-text { font-size: 0.75rem; font-weight: 600; color: #64748b; text-transform: uppercase; letter-spacing: 0.025em; }
        .value-text { font-size: 0.75rem; font-weight: 700; color: #1e293b; }
        
        /* Phosphorus Traffic Lights */
        .p-green { background-color: #f0fdf4; border-left: 4px solid #22c55e; }
        .p-yellow { background-color: #fefce8; border-left: 4px solid #eab308; }
        .p-red { background-color: #fef2f2; border-left: 4px solid #ef4444; }
        .p-neutral { background-color: #f8fafc; border-left: 4px solid #cbd5e1; }

        /* Traffic Light Dots */
        .dot-green { background-color: #22c55e; }
        .dot-yellow { background-color: #eab308; }
        .dot-red { background-color: #ef4444; }
        .dot-protein { background-color: #38bdf8; }
    </style>
</head>
<body class="pb-24">

    <header class="bean-gradient text-white pt-12 pb-10 px-6 shadow-md rounded-b-[40px] mb-6 text-center">
        <h1 class="text-5xl font-extrabold tracking-tight">Bean</h1>
        <p class="text-sm font-medium opacity-80 mt-2" id="current-date"></p>
    </header>

    <main class="max-w-md mx-auto p-4 space-y-6">

        <section class="card p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-sm font-bold text-slate-800 uppercase tracking-wider">Net Daily Intake</h2>
                <button onclick="exportData()" class="text-[10px] bg-slate-100 text-slate-600 px-3 py-1 rounded-full font-bold uppercase">Export</button>
            </div>
            
            <div class="space-y-6">
                <div>
                    <div class="flex justify-between mb-2">
                        <span class="label-text">Potassium</span>
                        <span class="value-text"><span id="total-k">0</span> / <span id="disp-limit-k">2000</span> mg</span>
                    </div>
                    <div class="progress-bar-bg"><div id="bar-k" class="progress-fill" style="width: 0%; background-color: #34d399;"></div></div>
                </div>
                <div>
                    <div class="flex justify-between mb-2">
                        <span class="label-text">Net Phosphorus</span>
                        <span class="value-text"><span id="total-p">0</span> / <span id="disp-limit-p">1000</span> mg</span>
                    </div>
                    <div class="progress-bar-bg"><div id="bar-p" class="progress-fill" style="width: 0%; background-color: #a78bfa;"></div></div>
                </div>
                <div>
                    <div class="flex justify-between mb-2">
                        <span class="label-text">Fluid</span>
                        <span class="value-text"><span id="total-f">0</span> / <span id="disp-limit-f">1000</span> ml</span>
                    </div>
                    <div class="progress-bar-bg"><div id="bar-f" class="progress-fill" style="width: 0%; background-color: #38bdf8;"></div></div>
                </div>
            </div>
        </section>

        <div class="flex space-x-1 bg-slate-200/50 p-1.5 rounded-2xl">
            <button onclick="switchTab('food')" id="tab-food" class="flex-1 py-2.5 rounded-xl font-bold text-sm bg-white shadow-sm text-slate-800 transition-all">Food</button>
            <button onclick="switchTab('binder')" id="tab-binder" class="flex-1 py-2.5 rounded-xl font-bold text-sm text-slate-500 transition-all">Binder</button>
            <button onclick="switchTab('history')" id="tab-history" class="flex-1 py-2.5 rounded-xl font-bold text-sm text-slate-500 transition-all">History</button>
        </div>

        <section id="section-food" class="card p-5 space-y-4">
            <div class="relative">
                <input type="text" id="food-search" placeholder="Search foods (Milk, Cheese, Egg)..." 
                    class="w-full p-4 bg-slate-50 border-none rounded-2xl outline-none focus:ring-2 focus:ring-purple-200" 
                    onkeyup="searchFood(this.value)">
                <div id="search-results" class="hidden absolute z-30 w-full bg-white border rounded-2xl shadow-2xl mt-2 max-h-72 overflow-y-auto"></div>
            </div>
            
            <div class="text-center text-[10px] font-bold text-slate-400 uppercase tracking-widest">— OR —</div>
            
            <select id="category-select" class="w-full p-4 bg-slate-50 border-none rounded-2xl text-sm font-semibold" onchange="renderCategoryItems(this.value)">
                <option value="" disabled selected>Browse Categories</option>
            </select>
            <div id="category-items-list" class="space-y-2 mt-2 max-h-60 overflow-y-auto hidden"></div>
        </section>

        <section id="section-binder" class="hidden card p-6 text-center">
            <select id="binder-select" class="w-full p-4 bg-slate-50 border-none rounded-2xl text-sm mb-4" onchange="checkBinderEnable()">
                <option value="" disabled selected>Select Binder Type</option>
                <option value="0">Renvela/Sevelamer (800mg)</option>
                <option value="1">Phoslo/Calcium Acetate (667mg)</option>
                <option value="2">Tums/Calcium Carbonate (500mg)</option>
                <option value="3">Velphoro (500mg)</option>
                <option value="4">Auryxia (210mg Iron)</option>
                <option value="5">Fosrenol/Lanthanum (500mg)</option>
            </select>
            <div class="flex items-center justify-center space-x-8 py-4">
                <button onclick="changeQty(-1)" class="w-14 h-14 rounded-2xl bg-slate-100 text-2xl font-bold">-</button>
                <span id="binder-qty-display" class="text-4xl font-black w-10">1</span>
                <button onclick="changeQty(1)" class="w-14 h-14 rounded-2xl bg-slate-100 text-2xl font-bold">+</button>
            </div>
            <button onclick="addBinder()" id="add-binder-btn" class="w-full bg-slate-800 text-white font-bold py-5 rounded-2xl disabled:opacity-20" disabled>Add Binder</button>
        </section>

        <section id="section-history" class="hidden space-y-4">
            <div id="history-list" class="space-y-3"></div>
        </section>

        <section id="section-log">
            <div class="flex justify-between items-end mb-4 px-2">
                <h2 class="text-xl font-bold text-slate-800">Today's Entries</h2>
                <button onclick="clearToday()" class="text-[10px] text-red-400 font-black uppercase">Reset</button>
            </div>
            <ul id="log-list" class="space-y-3"></ul>
        </section>

        <section class="bg-slate-100 p-6 rounded-[32px] border border-slate-200">
            <h3 class="text-xs font-bold text-slate-500 uppercase tracking-widest text-center mb-4">Set Your Limits</h3>
            <div class="grid grid-cols-3 gap-4">
                <div><label class="label-text block text-center mb-1">K</label><input type="number" id="limit-k" class="w-full p-3 bg-white rounded-xl text-center font-bold" onchange="saveSettings()"></div>
                <div><label class="label-text block text-center mb-1">P</label><input type="number" id="limit-p" class="w-full p-3 bg-white rounded-xl text-center font-bold" onchange="saveSettings()"></div>
                <div><label class="label-text block text-center mb-1">Fluid</label><input type="number" id="limit-f" class="w-full p-3 bg-white rounded-xl text-center font-bold" onchange="saveSettings()"></div>
            </div>
        </section>
    </main>

    <script>
        const foodDatabase = {
    "Fruits": [
        { name: "Apple (1 med)", k: 195, p: 20, f: 0 },
        { name: "Blueberries (1/2 cup)", k: 57, p: 9, f: 0 },
        { name: "Strawberries (1/2 cup)", k: 115, p: 18, f: 0 },
        { name: "Raspberries (1/2 cup)", k: 93, p: 15, f: 0 },
        { name: "Blackberries (1/2 cup)", k: 116, p: 16, f: 0 },
        { name: "Grapes (10 small)", k: 88, p: 10, f: 0 },
        { name: "Pineapple (1/2 cup)", k: 90, p: 7, f: 0 },
        { name: "Watermelon (1 cup)", k: 170, p: 15, f: 140 },
        { name: "Peach (1 med)", k: 185, p: 20, f: 0 },
        { name: "Plum (1 med)", k: 104, p: 11, f: 0 },
        { name: "Pear (1 med)", k: 190, p: 20, f: 0 },
        { name: "Cherries (10)", k: 150, p: 15, f: 0 },
        { name: "Cranberries (1/2 cup)", k: 40, p: 6, f: 0 },
        { name: "Mandarin Orange (1 small)", k: 132, p: 10, f: 0 }
    ],
    "Dairy": [
        { name: "Milk (1 cup)", k: 366, p: 232, f: 240 },
        { name: "Rice Milk (1 cup)", k: 65, p: 48, f: 240 },
        { name: "Soy Milk (1 cup)", k: 300, p: 120, f: 240 },
        { name: "Almond Milk Vanilla (1 cup)", k: 120, p: 19, f: 240 },
        { name: "Yogurt (6 oz)", k: 398, p: 245, f: 170 },
        { name: "Cheddar Cheese (1 oz)", k: 28, p: 145, f: 0 },
        { name: "Cream Cheese (1 tbsp)", k: 14, p: 15, f: 0 },
        { name: "Hard Cheese (1 oz)", k: 20, p: 130, f: 0 },
        { name: "Cottage Cheese (1/2 cup)", k: 86, p: 150, f: 0 }
    ],
    "Vegetables": [
        { name: "Carrots (1/2 cup)", k: 180, p: 24, f: 0 }, 
        { name: "Green Beans (1/2 cup)", k: 90, p: 19, f: 0 }, 
        { name: "Cucumber (1/2 cup)", k: 70, p: 12, f: 25 },
        { name: "Onions (1/2 cup)", k: 125, p: 30, f: 0 },
        { name: "Cabbage (1/2 cup)", k: 60, p: 10, f: 0 },
        { name: "Cauliflower (1/2 cup)", k: 150, p: 20, f: 0 }
    ],
    "Proteins": [
        { name: "Chicken (3 oz)", k: 220, p: 196, f: 0 }, 
        { name: "Egg (1)", k: 69, p: 95, f: 0 }, 
        { name: "Beef (3 oz)", k: 270, p: 200, f: 0 },
        { name: "Salmon (3 oz)", k: 326, p: 214, f: 0 },
        { name: "Pork (3 oz)", k: 270, p: 180, f: 0 }
    ],
    "Beverages": [
        { name: "Water (8 oz)", k: 0, p: 0, f: 240 }, 
        { name: "Coffee (8 oz)", k: 116, p: 7, f: 240 },
        { name: "Tea (8 oz)", k: 88, p: 0, f: 240 },
        { name: "Lemonade (8 oz)", k: 40, p: 5, f: 240 }]
        };

        const binderDatabase = [
            { name: "Renvela/Sevelamer", bind: 17 }, { name: "Phoslo/Calcium Acetate", bind: 30 },
            { name: "Tums/Calcium Carbonate", bind: 19 }, { name: "Velphoro", bind: 130 },
            { name: "Auryxia", bind: 40 }, { name: "Fosrenol", bind: 45 }
        ];

        let dailyLog = JSON.parse(localStorage.getItem('bean_log')) || [];
        let limits = JSON.parse(localStorage.getItem('bean_limits')) || { k: 2000, p: 1000, f: 1000 };
        let binderQty = 1;

        function getDotColor(food, category) {
            if (category === "Proteins") return "dot-protein";
            if (food.p <= 50) return "dot-green";
            if (food.p <= 150) return "dot-yellow";
            return "dot-red";
        }

        function searchFood(query) {
            const resultsDiv = document.getElementById('search-results');
            if (query.length < 1) { resultsDiv.classList.add('hidden'); return; }
            let html = '';
            for (const [category, foods] of Object.entries(foodDatabase)) {
                foods.forEach(food => {
                    if (food.name.toLowerCase().includes(query.toLowerCase())) {
                        const dotClass = getDotColor(food, category);
                        html += `<div onclick='logFoodItem(${JSON.stringify(food)}, "${category}")' class="p-4 border-b hover:bg-slate-50 cursor-pointer flex justify-between items-center">
                            <div><div class="font-bold text-slate-700 text-sm">${food.name}</div><div class="text-[9px] text-slate-400 uppercase font-black">${category}</div></div>
                            <div class="w-3 h-3 rounded-full ${dotClass}"></div></div>`;
                    }
                });
            }
            resultsDiv.innerHTML = html || `<div class="p-4 text-xs text-slate-400">No matches found</div>`;
            resultsDiv.classList.remove('hidden');
        }

        function renderCategoryItems(cat) {
            const list = document.getElementById('category-items-list');
            list.innerHTML = ''; list.classList.remove('hidden');
            foodDatabase[cat].forEach(food => {
                const dotClass = getDotColor(food, cat);
                const div = document.createElement('div');
                div.className = "p-4 bg-slate-50 rounded-2xl flex justify-between items-center cursor-pointer";
                div.onclick = () => logFoodItem(food, cat);
                div.innerHTML = `<span class="font-bold text-sm text-slate-800">${food.name}</span><div class="w-3 h-3 rounded-full ${dotClass}"></div>`;
                list.appendChild(div);
            });
        }

        function logFoodItem(food, category) {
            dailyLog.push({ ...food, category, id: Date.now() });
            document.getElementById('food-search').value = '';
            document.getElementById('search-results').classList.add('hidden');
            document.getElementById('category-items-list').classList.add('hidden');
            document.getElementById('category-select').selectedIndex = 0;
            saveAll();
        }

        function renderLog() {
            const list = document.getElementById('log-list'); list.innerHTML = '';
            dailyLog.slice().reverse().forEach(i => {
                const li = document.createElement('li');
                let pClass = i.category === "Proteins" || i.category === "Binder" ? "p-neutral" : (i.p <= 50 ? "p-green" : (i.p <= 150 ? "p-yellow" : "p-red"));
                li.className = `p-4 rounded-3xl flex justify-between items-center ${pClass} mb-3 shadow-sm`;
                li.innerHTML = `<div><div class="font-bold text-sm text-slate-800">${i.name}</div>
                    <div class="text-[10px] opacity-60 font-bold uppercase tracking-tighter">K: ${i.k} P: ${i.p} F: ${i.f}ml ${i.category === 'Proteins' ? '• PROTEIN' : ''}</div></div>
                    <button onclick="removeItem(${i.id})" class="opacity-30 px-2 text-lg">✕</button>`;
                list.appendChild(li);
            });
        }

        function updateTotals() {
            let tk=0, tp=0, tf=0; dailyLog.forEach(i => { tk+=i.k; tp+=i.p; tf+=i.f; });
            document.getElementById('total-k').textContent = tk;
            document.getElementById('total-p').textContent = Math.max(0, tp);
            document.getElementById('total-f').textContent = tf;
            updateBar('bar-k', tk, limits.k);
            updateBar('bar-p', Math.max(0, tp), limits.p);
            updateBar('bar-f', tf, limits.f);
        }

        function updateBar(id, v, m) {
            const pct = Math.min((v/m)*100, 100);
            const b = document.getElementById(id);
            b.style.width = pct+'%';
            b.style.backgroundColor = pct >= 100 ? "#f43f5e" : (id==='bar-k'?"#34d399":id==='bar-p'?"#a78bfa":"#38bdf8");
        }

        function changeQty(amt) { binderQty = Math.max(1, binderQty + amt); document.getElementById('binder-qty-display').textContent = binderQty; }
        function checkBinderEnable() { document.getElementById('add-binder-btn').disabled = false; }
        function addBinder() {
            const b = binderDatabase[document.getElementById('binder-select').value];
            dailyLog.push({ name: `${binderQty}x ${b.name}`, k: 0, p: -(b.bind * binderQty), f: 0, category: 'Binder', id: Date.now() });
            saveAll();
        }

        function saveAll() { localStorage.setItem('bean_log', JSON.stringify(dailyLog)); updateTotals(); renderLog(); }
        function saveSettings() {
            limits = { k: parseInt(document.getElementById('limit-k').value)||2000, p: parseInt(document.getElementById('limit-p').value)||1000, f: parseInt(document.getElementById('limit-f').value)||1000 };
            localStorage.setItem('bean_limits', JSON.stringify(limits));
            document.getElementById('disp-limit-k').textContent = limits.k; document.getElementById('disp-limit-p').textContent = limits.p; document.getElementById('disp-limit-f').textContent = limits.f;
            updateTotals();
        }
        function removeItem(id) { dailyLog = dailyLog.filter(i => i.id !== id); saveAll(); }
        function clearToday() { if(confirm("Reset today?")) { dailyLog = []; saveAll(); } }
        function switchTab(t) { 
            ['food', 'binder', 'history'].forEach(tab => {
                document.getElementById(`section-${tab}`).classList.toggle('hidden', t !== tab);
                const btn = document.getElementById(`tab-${tab}`);
                if(t===tab){ btn.classList.add('bg-white','shadow-sm','text-slate-800'); btn.classList.remove('text-slate-500'); }
                else { btn.classList.remove('bg-white','shadow-sm','text-slate-800'); btn.classList.add('text-slate-500'); }
            }); 
        }

        function init() {
            document.getElementById('current-date').textContent = new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' });
            document.getElementById('limit-k').value = limits.k; document.getElementById('limit-p').value = limits.p; document.getElementById('limit-f').value = limits.f;
            document.getElementById('disp-limit-k').textContent = limits.k; document.getElementById('disp-limit-p').textContent = limits.p; document.getElementById('disp-limit-f').textContent = limits.f;
            const cs = document.getElementById('category-select'); Object.keys(foodDatabase).forEach(cat => cs.add(new Option(cat, cat)));
            saveAll();
        }
        init();
    </script>
</body>
</html>



